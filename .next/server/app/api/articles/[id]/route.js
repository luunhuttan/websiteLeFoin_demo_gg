"use strict";(()=>{var e={};e.id=977,e.ids=[977],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},42007:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>v,originalPathname:()=>y,patchFetch:()=>E,requestAsyncStorage:()=>g,routeModule:()=>f,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>N});var a={};r.r(a),r.d(a,{DELETE:()=>d,GET:()=>p,POST:()=>w,PUT:()=>c});var i=r(95419),s=r(69108),n=r(99678),o=r(19631),l=r(81355),u=r(45952);async function c(e,{params:t}){try{let{title:r,content:a,tags:i}=await e.json();if(!r||!a)return new Response(JSON.stringify({error:"Missing title or content"}),{status:400});let s=Array.isArray(i)?i:i?[i]:[],n=await o.Z.article.update({where:{id:Number(t.id)},data:{title:r,content:a}});if(await o.Z.articletag.deleteMany({where:{articleId:n.id}}),s.length>0)for(let e of s){let t=await o.Z.tag.findUnique({where:{name:e}});t||(t=await o.Z.tag.create({data:{name:e}})),await o.Z.articletag.create({data:{articleId:n.id,tagId:t.id}})}let l=await o.Z.article.findUnique({where:{id:n.id},include:{articletag:{include:{tag:!0}}}}),u=(l?.articletag||[]).map(e=>({name:e.tag.name}));return new Response(JSON.stringify({...l,tags:u}),{status:200})}catch(e){return new Response(JSON.stringify({error:"Internal server error"}),{status:500})}}async function d(e,{params:t}){let r=await (0,l.getServerSession)(u.L);return r?.user?.role&&"admin"===r.user.role?(await o.Z.article.delete({where:{id:Number(t.id)}}),new Response(JSON.stringify({success:!0}),{status:200})):new Response(JSON.stringify({error:"Unauthorized"}),{status:401})}async function p(e,{params:t}){try{let e=await (0,l.getServerSession)(u.L),r=await o.Z.article.findUnique({where:{id:Number(t.id)},include:{articletag:{include:{tag:!0}}}});if(!r)return new Response(JSON.stringify({error:"Not found"}),{status:404});let a=(r.articletag||[]).map(e=>({name:e.tag.name})),i=!1;if(e?.user?.email){let t=await o.Z.user.findUnique({where:{email:e.user.email},include:{favoriteArticles:{where:{id:r.id}}}});i=(t?.favoriteArticles?.length||0)>0}return new Response(JSON.stringify({...r,tags:a,isFavorite:i}),{status:200})}catch(e){return new Response(JSON.stringify({error:"Internal server error"}),{status:500})}}async function w(e,{params:t}){let r=await (0,l.getServerSession)(u.L);if(!r||!r.user?.email)return new Response(JSON.stringify({error:"Unauthorized"}),{status:401});let a=await o.Z.user.findUnique({where:{email:r.user.email},include:{favoriteArticles:!0}});if(!a)return new Response(JSON.stringify({error:"User not found"}),{status:404});let i=Number(t.id);return a.favoriteArticles.some(e=>e.id===i)?(await o.Z.user.update({where:{id:a.id},data:{favoriteArticles:{disconnect:{id:i}}}}),new Response(JSON.stringify({favorited:!1}),{status:200})):(await o.Z.user.update({where:{id:a.id},data:{favoriteArticles:{connect:{id:i}}}}),new Response(JSON.stringify({favorited:!0}),{status:200}))}let f=new i.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/articles/[id]/route",pathname:"/api/articles/[id]",filename:"route",bundlePath:"app/api/articles/[id]/route"},resolvedPagePath:"D:\\websiteLeFoin_demo_gg\\src\\app\\api\\articles\\[id]\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:g,staticGenerationAsyncStorage:m,serverHooks:h,headerHooks:v,staticGenerationBailout:N}=f,y="/api/articles/[id]/route";function E(){return(0,n.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}},19631:(e,t,r)=>{r.d(t,{Z:()=>s,_:()=>i});let a=require("@prisma/client"),i=globalThis.prisma??new a.PrismaClient,s=i},45952:(e,t,r)=>{r.d(t,{L:()=>d});var a=r(81355),i=r.n(a),s=r(10375),n=r(98904),o=r(50694),l=r(69568),u=r(86485),c=r(19631);let d={providers:[(0,u.Z)({name:"Credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e,t){let r=process.env.NEXTAUTH_URL||(process.env.VERCEL_URL?`https://${process.env.VERCEL_URL}`:"http://localhost:3000"),a=r=r.trim().replace(/^https?:\/\/[\s]*https?:\/\//,"https://").replace(/\s+/g,""),i=await fetch(`${a}/api/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e?.email,password:e?.password})}),s=await i.json();return i.ok&&s?s:null}}),(0,s.Z)({clientId:process.env.GOOGLE_CLIENT_ID||"",clientSecret:process.env.GOOGLE_CLIENT_SECRET||""}),(0,n.Z)({clientId:process.env.FACEBOOK_CLIENT_ID||"",clientSecret:process.env.FACEBOOK_CLIENT_SECRET||""}),(0,o.Z)({clientId:process.env.GITHUB_CLIENT_ID||"",clientSecret:process.env.GITHUB_CLIENT_SECRET||""}),(0,l.Z)({clientId:process.env.LINKEDIN_CLIENT_ID||"",clientSecret:process.env.LINKEDIN_CLIENT_SECRET||""})],session:{strategy:"jwt"},callbacks:{jwt:async({token:e,user:t})=>(t&&(e.id=t.id,e.role=t.role,e.firstName=t.firstName,e.lastName=t.lastName,e.avatar=t.avatar||e.avatar),e),async session({session:e,token:t}){if(t){e.user.id=t.id,e.user.role=t.role,e.user.firstName=t.firstName,e.user.lastName=t.lastName;let r=await c.Z.user.findUnique({where:{email:e.user.email}});e.user.avatar=r?.avatar||t.avatar}return e}},pages:{signIn:"/auth"}};i()(d)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[1638,7072],()=>r(42007));module.exports=a})();
(()=>{var e={};e.id=6873,e.ids=[6873],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},67791:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>c,originalPathname:()=>p,pages:()=>u,routeModule:()=>g,tree:()=>d});var s=r(50482),n=r(69108),a=r(62563),i=r.n(a),o=r(68300),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);r.d(t,l);let d=["",{children:["user",{children:["profile",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,41173)),"D:\\websiteLeFoin_demo_gg\\src\\app\\user\\profile\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,58188)),"D:\\websiteLeFoin_demo_gg\\src\\app\\layout.tsx"],error:[()=>Promise.resolve().then(r.bind(r,24117)),"D:\\websiteLeFoin_demo_gg\\src\\app\\error.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,69361,23)),"next/dist/client/components/not-found-error"]}],u=["D:\\websiteLeFoin_demo_gg\\src\\app\\user\\profile\\page.tsx"],p="/user/profile/page",c={require:r,loadChunk:()=>Promise.resolve()},g=new s.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/user/profile/page",pathname:"/user/profile",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},13431:(e,t,r)=>{Promise.resolve().then(r.bind(r,6024))},6024:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o});var s=r(95344),n=r(47674),a=r(8428),i=r(3729);function o(){let{data:e,status:t,update:r}=(0,n.useSession)(),o=(0,a.useRouter)(),[l,d]=(0,i.useState)(""),[u,p]=(0,i.useState)(""),[c,g]=(0,i.useState)(""),[h,x]=(0,i.useState)(!1),[m,f]=(0,i.useState)(""),[y,b]=(0,i.useState)(""),[j,v]=(0,i.useState)(""),[w,k]=(0,i.useState)(""),[_,S]=(0,i.useState)(!1),[T,C]=(0,i.useState)(null),[P,q]=(0,i.useState)(""),[M,N]=(0,i.useState)(!1);if((0,i.useEffect)(()=>{"loading"!==t&&(e?"admin"===e.user.role?o.replace("/admin"):(d(e.user.firstName||""),p(e.user.lastName||""),C(e.user.avatar||null)):o.replace("/login"))},[e,t,o]),"loading"===t||!e||"admin"===e.user.role)return s.jsx("div",{children:"Đang tải..."});let{email:E,role:B}=e.user,O=async e=>{e.preventDefault(),x(!0),g("");let t=await fetch("/api/user/update-profile",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({firstName:l,lastName:u})}),s=await t.json();x(!1),g(s.message||(t.ok?"Cập nhật th\xe0nh c\xf4ng":"C\xf3 lỗi xảy ra")),t.ok&&r()},D=async e=>{if(e.preventDefault(),k(""),y!==j){k("Mật khẩu mới kh\xf4ng khớp!");return}S(!0);let t=await fetch("/api/user/change-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({oldPassword:m,newPassword:y})}),r=await t.json();S(!1),k(r.message||(t.ok?"Đổi mật khẩu th\xe0nh c\xf4ng":"C\xf3 lỗi xảy ra")),t.ok&&(f(""),b(""),v(""))},L=async e=>{e.preventDefault(),q(""),N(!0);let t=e.target.elements.namedItem("avatar");if(!t?.files?.[0]){q("Vui l\xf2ng chọn ảnh!"),N(!1);return}let s=new FormData;s.append("avatar",t.files[0]);let n=await fetch("/api/user/upload-avatar",{method:"POST",body:s}),a=await n.json();N(!1),q(a.message||(n.ok?"Upload th\xe0nh c\xf4ng":"C\xf3 lỗi xảy ra")),n.ok&&a.avatar&&(C(a.avatar),r(),window.location.href=window.location.href)};return(0,s.jsxs)("div",{style:{maxWidth:500,margin:"40px auto",padding:24,background:"#fff",borderRadius:12,boxShadow:"0 2px 8px #eee"},children:[s.jsx("h2",{children:"Th\xf4ng tin c\xe1 nh\xe2n"}),(0,s.jsxs)("div",{style:{textAlign:"center",marginBottom:16},children:[s.jsx("img",{src:T||"/images/avatar-default.png",alt:"avatar",style:{width:96,height:96,borderRadius:"50%",objectFit:"cover",border:"2px solid #eee",margin:"0 auto"}}),(0,s.jsxs)("form",{onSubmit:L,style:{marginTop:8},children:[s.jsx("input",{type:"file",name:"avatar",accept:"image/*",className:"mb-2"}),s.jsx("button",{type:"submit",className:"bg-green-500 text-white px-3 py-1 rounded",disabled:M,children:M?"Đang tải...":"Đổi ảnh đại diện"})]}),P&&s.jsx("div",{style:{marginTop:4,color:P.includes("th\xe0nh c\xf4ng")?"green":"red"},children:P})]}),(0,s.jsxs)("p",{children:[s.jsx("b",{children:"Email:"})," ",E]}),(0,s.jsxs)("p",{children:[s.jsx("b",{children:"Vai tr\xf2:"})," ",B]}),(0,s.jsxs)("form",{onSubmit:O,style:{marginTop:24},children:[(0,s.jsxs)("div",{style:{marginBottom:12},children:[s.jsx("label",{children:"Họ:"}),s.jsx("input",{value:u,onChange:e=>p(e.target.value),className:"border rounded px-2 py-1 w-full",required:!0})]}),(0,s.jsxs)("div",{style:{marginBottom:12},children:[s.jsx("label",{children:"T\xean:"}),s.jsx("input",{value:l,onChange:e=>d(e.target.value),className:"border rounded px-2 py-1 w-full",required:!0})]}),s.jsx("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded",disabled:h,children:h?"Đang lưu...":"Lưu th\xf4ng tin"}),c&&s.jsx("div",{style:{marginTop:8,color:c.includes("th\xe0nh c\xf4ng")?"green":"red"},children:c})]}),s.jsx("hr",{style:{margin:"32px 0"}}),s.jsx("h3",{style:{marginBottom:"16px",color:"#7A5C42"},children:"T\xednh năng"}),(0,s.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"12px",marginBottom:"24px"},children:[(0,s.jsxs)("button",{onClick:()=>o.push("/user/favorites"),style:{background:"#E5873E",color:"#fff",border:"none",borderRadius:"8px",padding:"12px 16px",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.3s ease",display:"flex",alignItems:"center",gap:"8px",justifyContent:"center"},onMouseOver:e=>{e.currentTarget.style.background="#d17a36",e.currentTarget.style.transform="translateY(-2px)"},onMouseOut:e=>{e.currentTarget.style.background="#E5873E",e.currentTarget.style.transform="translateY(0)"},children:[s.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:s.jsx("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"})}),"B\xe0i viết y\xeau th\xedch"]}),(0,s.jsxs)("button",{onClick:()=>o.push("/user/history"),style:{background:"#48664E",color:"#fff",border:"none",borderRadius:"8px",padding:"12px 16px",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.3s ease",display:"flex",alignItems:"center",gap:"8px",justifyContent:"center"},onMouseOver:e=>{e.currentTarget.style.background="#3d523e",e.currentTarget.style.transform="translateY(-2px)"},onMouseOut:e=>{e.currentTarget.style.background="#48664E",e.currentTarget.style.transform="translateY(0)"},children:[(0,s.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:[s.jsx("path",{d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),s.jsx("path",{d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"Lịch sử xem"]})]}),s.jsx("h3",{children:"Đổi mật khẩu"}),(0,s.jsxs)("form",{onSubmit:D,children:[(0,s.jsxs)("div",{style:{marginBottom:12},children:[s.jsx("label",{children:"Mật khẩu cũ:"}),s.jsx("input",{type:"password",value:m,onChange:e=>f(e.target.value),className:"border rounded px-2 py-1 w-full",required:!0})]}),(0,s.jsxs)("div",{style:{marginBottom:12},children:[s.jsx("label",{children:"Mật khẩu mới:"}),s.jsx("input",{type:"password",value:y,onChange:e=>b(e.target.value),className:"border rounded px-2 py-1 w-full",required:!0})]}),(0,s.jsxs)("div",{style:{marginBottom:12},children:[s.jsx("label",{children:"Nhập lại mật khẩu mới:"}),s.jsx("input",{type:"password",value:j,onChange:e=>v(e.target.value),className:"border rounded px-2 py-1 w-full",required:!0})]}),s.jsx("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded",disabled:_,children:_?"Đang đổi...":"Đổi mật khẩu"}),w&&s.jsx("div",{style:{marginTop:8,color:w.includes("th\xe0nh c\xf4ng")?"green":"red"},children:w})]})]})}},41173:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>a,__esModule:()=>n,default:()=>i});let s=(0,r(86843).createProxy)(String.raw`D:\websiteLeFoin_demo_gg\src\app\user\profile\page.tsx`),{__esModule:n,$$typeof:a}=s,i=s.default}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[1638,2659,2263],()=>r(67791));module.exports=s})();
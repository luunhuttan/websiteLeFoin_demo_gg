(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[379],{566:function(e,t,a){Promise.resolve().then(a.bind(a,7533))},5601:function(e,t){"use strict";function a(){return null}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return a}}),("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},7533:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return x}});var s=a(3827),r=a(4090),n=a(7907),l=a(5601),i=a.n(l),c=a(1126),d=a(8009);function o(e){let{productId:t,productName:a}=e,{data:n}=(0,c.useSession)(),[l,i]=(0,r.useState)([]),[o,m]=(0,r.useState)(null),[x,h]=(0,r.useState)(!0),[g,u]=(0,r.useState)(!1),[b,p]=(0,r.useState)(5),[f,j]=(0,r.useState)(""),[y,v]=(0,r.useState)(!1);(0,r.useEffect)(()=>{N()},[t]);let N=async()=>{try{let e=await fetch("/api/reviews?productId=".concat(t));if(e.ok){let t=await e.json();i(t.reviews),m({averageRating:t.averageRating,totalReviews:t.totalReviews,ratingCounts:t.ratingCounts})}}catch(e){console.error("Error fetching reviews:",e)}finally{h(!1)}},w=async e=>{if(e.preventDefault(),!n){d.ZP.error("Vui l\xf2ng đăng nhập để đ\xe1nh gi\xe1 sản phẩm");return}v(!0);try{let e=await fetch("/api/reviews",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({productId:t,rating:b,comment:f})});if(e.ok)d.ZP.success("Cảm ơn bạn đ\xe3 đ\xe1nh gi\xe1 sản phẩm!"),u(!1),p(5),j(""),N();else{let t=await e.json();d.ZP.error(t.error||"C\xf3 lỗi xảy ra khi gửi đ\xe1nh gi\xe1")}}catch(e){console.error("Error submitting review:",e),d.ZP.error("C\xf3 lỗi xảy ra khi gửi đ\xe1nh gi\xe1")}finally{v(!1)}},k=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,s.jsx)("div",{className:"flex gap-1",children:[1,2,3,4,5].map(a=>(0,s.jsx)("button",{type:t?"button":void 0,onClick:t?()=>p(a):void 0,className:"text-xl ".concat(t?"cursor-pointer":""),disabled:!t,children:a<=e?"⭐":"☆"},a))})},C=e=>new Date(e).toLocaleDateString("vi-VN",{year:"numeric",month:"long",day:"numeric"});return x?(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)("div",{className:"inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-amber-500"}),(0,s.jsx)("p",{className:"mt-2",children:"Đang tải đ\xe1nh gi\xe1..."})]}):(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[(0,s.jsx)("h3",{className:"text-2xl font-bold text-leaf mb-6",children:"Đ\xe1nh gi\xe1 sản phẩm"}),o&&(0,s.jsxs)("div",{className:"flex items-center gap-8 mb-8 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-3xl font-bold text-amber-600",children:o.averageRating}),(0,s.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Điểm trung b\xecnh"})]}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[k(Math.round(o.averageRating)),(0,s.jsxs)("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:["(",o.totalReviews," đ\xe1nh gi\xe1)"]})]}),(0,s.jsx)("div",{className:"space-y-1",children:[5,4,3,2,1].map(e=>(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("span",{className:"text-sm w-8",children:[e,"⭐"]}),(0,s.jsx)("div",{className:"flex-1 bg-gray-200 dark:bg-gray-600 rounded-full h-2",children:(0,s.jsx)("div",{className:"bg-amber-500 h-2 rounded-full",style:{width:"".concat(o.totalReviews>0?o.ratingCounts[e]/o.totalReviews*100:0,"%")}})}),(0,s.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-300 w-8",children:o.ratingCounts[e]})]},e))})]})]}),n&&!g&&(0,s.jsx)("button",{onClick:()=>u(!0),className:"mb-6 bg-amber-500 hover:bg-amber-600 text-white px-6 py-2 rounded-lg font-semibold transition-colors",children:"Viết đ\xe1nh gi\xe1"}),g&&(0,s.jsxs)("form",{onSubmit:w,className:"mb-8 p-4 border border-gray-200 dark:border-gray-600 rounded-lg",children:[(0,s.jsx)("h4",{className:"font-semibold text-leaf mb-4",children:"Đ\xe1nh gi\xe1 của bạn"}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Đ\xe1nh gi\xe1"}),k(b,!0)]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Nhận x\xe9t (t\xf9y chọn)"}),(0,s.jsx)("textarea",{value:f,onChange:e=>j(e.target.value),className:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent dark:bg-gray-700 dark:text-white",rows:4,placeholder:"Chia sẻ trải nghiệm của bạn với sản phẩm n\xe0y..."})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{type:"submit",disabled:y,className:"bg-amber-500 hover:bg-amber-600 text-white px-4 py-2 rounded-lg font-semibold transition-colors disabled:opacity-50",children:y?"Đang gửi...":"Gửi đ\xe1nh gi\xe1"}),(0,s.jsx)("button",{type:"button",onClick:()=>u(!1),className:"bg-gray-300 hover:bg-gray-400 text-gray-700 px-4 py-2 rounded-lg font-semibold transition-colors",children:"Hủy"})]})]}),(0,s.jsx)("div",{className:"space-y-6",children:0===l.length?(0,s.jsx)("p",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:"Chưa c\xf3 đ\xe1nh gi\xe1 n\xe0o cho sản phẩm n\xe0y."}):l.map(e=>(0,s.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-600 pb-6 last:border-b-0",children:(0,s.jsxs)("div",{className:"flex items-start gap-4",children:[(0,s.jsx)("div",{className:"w-10 h-10 bg-amber-500 rounded-full flex items-center justify-center text-white font-semibold",children:e.user.firstName?e.user.firstName.charAt(0).toUpperCase():e.user.email.charAt(0).toUpperCase()}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)("span",{className:"font-semibold text-leaf",children:e.user.firstName?"".concat(e.user.firstName," ").concat(e.user.lastName||""):e.user.email}),(0,s.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:C(e.createdAt)})]}),(0,s.jsx)("div",{className:"mb-2",children:k(e.rating)}),e.comment&&(0,s.jsx)("p",{className:"text-gray-700 dark:text-gray-300",children:e.comment})]})]})},e.id))})]})}var m=a(5115);function x(){var e;let t=(0,n.useParams)(),a=(null==t?void 0:t.id)?parseInt(t.id):0,[l,c]=(0,r.useState)(null),[d,x]=(0,r.useState)(!0);(0,r.useEffect)(()=>{a&&h()},[a]);let h=async()=>{try{let e=await fetch("/api/products/".concat(a));if(e.ok){let t=await e.json();c(t)}else c({id:a,name:"Sản phẩm #".concat(a),description:"Th\xf4ng tin sản phẩm",price:0,image:"/images/default-product.jpg"})}catch(e){console.error("Error fetching product:",e),c({id:a,name:"Sản phẩm #".concat(a),description:"Th\xf4ng tin sản phẩm",price:0,image:"/images/default-product.jpg"})}finally{x(!1)}};return d?(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-amber-500"}),(0,s.jsx)("p",{className:"mt-2",children:"Đang tải th\xf4ng tin sản phẩm..."})]}):l?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(i(),{children:[(0,s.jsxs)("title",{children:["Đ\xe1nh gi\xe1 - ",l.name," | Le Foin"]}),(0,s.jsx)("meta",{name:"description",content:"Đ\xe1nh gi\xe1 v\xe0 nhận x\xe9t về sản phẩm ".concat(l.name," từ Le Foin")})]}),(0,s.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[(0,s.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-8",children:(0,s.jsxs)("div",{className:"flex items-center gap-6",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)("img",{src:l.image||"/images/default-product.jpg",alt:l.name,className:"w-24 h-24 object-cover rounded-lg"})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-leaf mb-2",children:l.name}),l.description&&(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-300 mb-2",children:l.description}),l.category&&(0,s.jsx)("span",{className:"inline-block bg-amber-100 text-amber-800 text-xs px-2 py-1 rounded-full mb-2",children:l.category}),(0,s.jsx)("div",{className:"text-xl font-bold text-amber-600",children:(e=l.price,new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(e))})]}),(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)("a",{href:"https://shopee.vn/search?keyword=".concat(encodeURIComponent(l.name)),target:"_blank",rel:"noopener noreferrer",className:"bg-orange-500 hover:bg-orange-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors",children:"Mua tr\xean Shopee"})})]})}),(0,s.jsx)(m.Z,{productId:a}),(0,s.jsx)(o,{productId:a,productName:l.name})]})]}):(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:"Kh\xf4ng t\xecm thấy sản phẩm"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Sản phẩm bạn đang t\xecm kiếm kh\xf4ng tồn tại."})]})}},5115:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var s=a(3827),r=a(4090);function n(e){let{productId:t}=e,[a,n]=(0,r.useState)(null),[l,i]=(0,r.useState)(!0);(0,r.useEffect)(()=>{c()},[t]);let c=async()=>{try{let e=await fetch(t?"/api/reviews/stats?productId=".concat(t):"/api/reviews/stats");if(e.ok){let t=await e.json();n(t)}}catch(e){console.error("Error fetching review stats:",e)}finally{i(!1)}};return l?(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)("div",{className:"inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-amber-500"}),(0,s.jsx)("p",{className:"mt-2",children:"Đang tải thống k\xea..."})]}):a&&0!==a.totalReviews?(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[(0,s.jsx)("h3",{className:"text-xl font-bold text-leaf mb-4",children:"Đ\xe1nh gi\xe1 từ kh\xe1ch h\xe0ng"}),(0,s.jsxs)("div",{className:"flex items-center gap-6 mb-6",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-3xl font-bold text-amber-600",children:a.averageRating}),(0,s.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Điểm trung b\xecnh"})]}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(e=>{let t=Math.floor(e),a=e%1!=0;return(0,s.jsx)("div",{className:"flex gap-1",children:[1,2,3,4,5].map(e=>(0,s.jsx)("span",{className:"text-lg",children:e<=t?"⭐":e===t+1&&a?"⭐":"☆"},e))})})(Math.round(a.averageRating)),(0,s.jsxs)("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:["(",a.totalReviews," đ\xe1nh gi\xe1)"]})]}),(0,s.jsx)("div",{className:"space-y-1",children:[5,4,3,2,1].map(e=>(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("span",{className:"text-sm w-8",children:[e,"⭐"]}),(0,s.jsx)("div",{className:"flex-1 bg-gray-200 dark:bg-gray-600 rounded-full h-2",children:(0,s.jsx)("div",{className:"bg-amber-500 h-2 rounded-full",style:{width:"".concat(a.totalReviews>0?a.ratingCounts[e]/a.totalReviews*100:0,"%")}})}),(0,s.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-300 w-8",children:a.ratingCounts[e]})]},e))})]})]}),(0,s.jsx)("div",{className:"text-center",children:(0,s.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:["Dựa tr\xean ",a.totalReviews," đ\xe1nh gi\xe1 từ kh\xe1ch h\xe0ng thực tế"]})})]}):null}}},function(e){e.O(0,[267,9,971,69,744],function(){return e(e.s=566)}),_N_E=e.O()}]);
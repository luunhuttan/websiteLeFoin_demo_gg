(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[873],{2636:function(e,t,r){Promise.resolve().then(r.bind(r,5364))},5364:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return l}});var n=r(3827),a=r(1126),s=r(7907),i=r(4090);function l(){let{data:e,status:t,update:r}=(0,a.useSession)(),l=(0,s.useRouter)(),[o,d]=(0,i.useState)(""),[u,c]=(0,i.useState)(""),[h,p]=(0,i.useState)(""),[g,x]=(0,i.useState)(!1),[m,f]=(0,i.useState)(""),[y,b]=(0,i.useState)(""),[j,v]=(0,i.useState)(""),[w,k]=(0,i.useState)(""),[S,C]=(0,i.useState)(!1),[T,N]=(0,i.useState)(null),[B,E]=(0,i.useState)(""),[O,M]=(0,i.useState)(!1);if((0,i.useEffect)(()=>{"loading"!==t&&(e?"admin"===e.user.role?l.replace("/admin"):(d(e.user.firstName||""),c(e.user.lastName||""),N(e.user.avatar||null)):l.replace("/login"))},[e,t,l]),"loading"===t||!e||"admin"===e.user.role)return(0,n.jsx)("div",{children:"Đang tải..."});let{email:_,role:q}=e.user,z=async e=>{e.preventDefault(),x(!0),p("");let t=await fetch("/api/user/update-profile",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({firstName:o,lastName:u})}),n=await t.json();x(!1),p(n.message||(t.ok?"Cập nhật th\xe0nh c\xf4ng":"C\xf3 lỗi xảy ra")),t.ok&&r()},R=async e=>{if(e.preventDefault(),k(""),y!==j){k("Mật khẩu mới kh\xf4ng khớp!");return}C(!0);let t=await fetch("/api/user/change-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({oldPassword:m,newPassword:y})}),r=await t.json();C(!1),k(r.message||(t.ok?"Đổi mật khẩu th\xe0nh c\xf4ng":"C\xf3 lỗi xảy ra")),t.ok&&(f(""),b(""),v(""))},D=async e=>{var t;e.preventDefault(),E(""),M(!0);let n=e.target.elements.namedItem("avatar");if(!(null==n?void 0:null===(t=n.files)||void 0===t?void 0:t[0])){E("Vui l\xf2ng chọn ảnh!"),M(!1);return}let a=new FormData;a.append("avatar",n.files[0]);let s=await fetch("/api/user/upload-avatar",{method:"POST",body:a}),i=await s.json();M(!1),E(i.message||(s.ok?"Upload th\xe0nh c\xf4ng":"C\xf3 lỗi xảy ra")),s.ok&&i.avatar&&(N(i.avatar),r(),window.location.href=window.location.href)};return(0,n.jsxs)("div",{style:{maxWidth:500,margin:"40px auto",padding:24,background:"#fff",borderRadius:12,boxShadow:"0 2px 8px #eee"},children:[(0,n.jsx)("h2",{children:"Th\xf4ng tin c\xe1 nh\xe2n"}),(0,n.jsxs)("div",{style:{textAlign:"center",marginBottom:16},children:[(0,n.jsx)("img",{src:T||"/images/avatar-default.png",alt:"avatar",style:{width:96,height:96,borderRadius:"50%",objectFit:"cover",border:"2px solid #eee",margin:"0 auto"}}),(0,n.jsxs)("form",{onSubmit:D,style:{marginTop:8},children:[(0,n.jsx)("input",{type:"file",name:"avatar",accept:"image/*",className:"mb-2"}),(0,n.jsx)("button",{type:"submit",className:"bg-green-500 text-white px-3 py-1 rounded",disabled:O,children:O?"Đang tải...":"Đổi ảnh đại diện"})]}),B&&(0,n.jsx)("div",{style:{marginTop:4,color:B.includes("th\xe0nh c\xf4ng")?"green":"red"},children:B})]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("b",{children:"Email:"})," ",_]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("b",{children:"Vai tr\xf2:"})," ",q]}),(0,n.jsxs)("form",{onSubmit:z,style:{marginTop:24},children:[(0,n.jsxs)("div",{style:{marginBottom:12},children:[(0,n.jsx)("label",{children:"Họ:"}),(0,n.jsx)("input",{value:u,onChange:e=>c(e.target.value),className:"border rounded px-2 py-1 w-full",required:!0})]}),(0,n.jsxs)("div",{style:{marginBottom:12},children:[(0,n.jsx)("label",{children:"T\xean:"}),(0,n.jsx)("input",{value:o,onChange:e=>d(e.target.value),className:"border rounded px-2 py-1 w-full",required:!0})]}),(0,n.jsx)("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded",disabled:g,children:g?"Đang lưu...":"Lưu th\xf4ng tin"}),h&&(0,n.jsx)("div",{style:{marginTop:8,color:h.includes("th\xe0nh c\xf4ng")?"green":"red"},children:h})]}),(0,n.jsx)("hr",{style:{margin:"32px 0"}}),(0,n.jsx)("h3",{style:{marginBottom:"16px",color:"#7A5C42"},children:"T\xednh năng"}),(0,n.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"12px",marginBottom:"24px"},children:[(0,n.jsxs)("button",{onClick:()=>l.push("/user/favorites"),style:{background:"#E5873E",color:"#fff",border:"none",borderRadius:"8px",padding:"12px 16px",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.3s ease",display:"flex",alignItems:"center",gap:"8px",justifyContent:"center"},onMouseOver:e=>{e.currentTarget.style.background="#d17a36",e.currentTarget.style.transform="translateY(-2px)"},onMouseOut:e=>{e.currentTarget.style.background="#E5873E",e.currentTarget.style.transform="translateY(0)"},children:[(0,n.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,n.jsx)("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"})}),"B\xe0i viết y\xeau th\xedch"]}),(0,n.jsxs)("button",{onClick:()=>l.push("/user/history"),style:{background:"#48664E",color:"#fff",border:"none",borderRadius:"8px",padding:"12px 16px",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.3s ease",display:"flex",alignItems:"center",gap:"8px",justifyContent:"center"},onMouseOver:e=>{e.currentTarget.style.background="#3d523e",e.currentTarget.style.transform="translateY(-2px)"},onMouseOut:e=>{e.currentTarget.style.background="#48664E",e.currentTarget.style.transform="translateY(0)"},children:[(0,n.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,n.jsx)("path",{d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,n.jsx)("path",{d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"Lịch sử xem"]})]}),(0,n.jsx)("h3",{children:"Đổi mật khẩu"}),(0,n.jsxs)("form",{onSubmit:R,children:[(0,n.jsxs)("div",{style:{marginBottom:12},children:[(0,n.jsx)("label",{children:"Mật khẩu cũ:"}),(0,n.jsx)("input",{type:"password",value:m,onChange:e=>f(e.target.value),className:"border rounded px-2 py-1 w-full",required:!0})]}),(0,n.jsxs)("div",{style:{marginBottom:12},children:[(0,n.jsx)("label",{children:"Mật khẩu mới:"}),(0,n.jsx)("input",{type:"password",value:y,onChange:e=>b(e.target.value),className:"border rounded px-2 py-1 w-full",required:!0})]}),(0,n.jsxs)("div",{style:{marginBottom:12},children:[(0,n.jsx)("label",{children:"Nhập lại mật khẩu mới:"}),(0,n.jsx)("input",{type:"password",value:j,onChange:e=>v(e.target.value),className:"border rounded px-2 py-1 w-full",required:!0})]}),(0,n.jsx)("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded",disabled:S,children:S?"Đang đổi...":"Đổi mật khẩu"}),w&&(0,n.jsx)("div",{style:{marginTop:8,color:w.includes("th\xe0nh c\xf4ng")?"green":"red"},children:w})]})]})}}},function(e){e.O(0,[267,971,69,744],function(){return e(e.s=2636)}),_N_E=e.O()}]);